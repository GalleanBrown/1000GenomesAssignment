# 1000 Genomes Assignment
This code will return a file with the observed and expected heterozygosity as well as the mean difference for each biallelic SNP as well as the averages for all three of these values for the vcf file of chromosome 22 from phase 3 of the 1000 genomes project. The two files provided in the assignment are the chromosome 22 vcf and a file matching each sample to a population and super population. As specified in the assignment, this code will be run for 3 populations: YRI, FIN, and JPT.

Since the vcf file is large, I did not want to load the whole thing, so I first began by using the integrated call samples file to obtain dataframes of samples for each of my target populations. I added three additonal columns from the vcf to this list (POS, REF, and ALT) that are useful in identifying SNPs. Since I wanted to use the header to load certain parts of the vcf and since the header begins with "#CHROM", I was not able to use comment = "#" in read_csv. To get around this, I used a for loop to find the line that contains "#CHROM" and stored that in a variable called header, which I made into a list. I used this list for "names" and the list of my columns of interest for "usecols". Since the metadata lines were still being read, this resulted in many rows of NA values, so I dropped these as well as unnecessary rows. Unnecessary rows included a row that was a repeat of the header, rows that aren't SNPs (rows where REF = ALT, as well as rows that contain indels), and SNPs that have more than 2 alleles. Now the data contains only rows that have biallelic SNPs and columns that correspond only to the three populations I will be looking at.

I know that I want the function I am writing to take in a list of samples from each population, so I converted each population's samples dataframe into lists. I also created a smaller version of the data to work with while writing the function. The heterozygosity function takes in a list of samples (of whichever population you are interested in) and returns both a results table containing SNP position, observed heterozygosity, expected heterozygosity, and the mean difference in observed/expected heterozygosity, as well as an averages table containing average values for observed/expected heterozygosity and mean difference across all SNPs. The function first subsets the original data to only consider samples in the target population and initializes the results table. At first I wrote this function to iterate over each SNP but after testing it with the entire dataset, it was taking over 8 hours to run (I left it running overnight). I stopped the code and rethought it to increase efficiency. The function stores the dataframe in an array. I mapped each genotype to a number and stored their counts in variables. From here observed/expected heterozygosity as well as the mean difference for each SNP can be calculated. These are stored into the results table along with SNP position and an averages table is created.

From there, I wanted to output the results to an excel spreadsheet with a separate sheet for averages and each population's results, but the data was too large. I am less familiar with json files, but that is the format I decided to use since it is flexible and readable. This was too large for github so I compressed this file.
